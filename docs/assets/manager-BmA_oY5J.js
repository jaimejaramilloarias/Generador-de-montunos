let e=null,u=null,r=[],d=120;const c=new Set;function s(){return e?Array.from(e.outputs.values()).map(t=>({id:t.id,name:t.name??t.id,manufacturer:t.manufacturer??null})):[]}function y(){const t=s();u&&!t.some(n=>n.id===u)&&(u=null),c.forEach(n=>n(t))}function i(){return!e||!u?null:e.outputs.get(u)??null}function f(t){for(let n=0;n<16;n+=1)t.send([176+n,123,0])}async function g(){if(typeof navigator>"u"||typeof navigator.requestMIDIAccess!="function")return{status:"unavailable",outputs:[]};if(e)return{status:"ready",outputs:s()};try{return e=await navigator.requestMIDIAccess({sysex:!1}),e.onstatechange=()=>{y()},{status:"ready",outputs:s()}}catch(t){return console.warn("Acceso MIDI denegado o no disponible.",t),e=null,{status:"denied",outputs:[]}}}function M(t){return c.add(t),e&&t(s()),()=>{c.delete(t)}}function A(t){if(u===t)return;const n=i();n&&f(n),u=t}function I(t,n){r=t.map(a=>({...a})),d=n,t.length===0&&h()}function O(){const t=i();if(!t||r.length===0)return;f(t);const n=60/d,a=typeof performance<"u"?performance.now():Date.now();r.forEach(o=>{const l=a+o.time*n*1e3,p=Math.max(50,o.duration*n*1e3),m=Math.max(0,Math.min(127,Math.round(o.velocity*127)));t.send([144,o.midi,m],l),t.send([128,o.midi,0],l+p)})}function h(){const t=i();t&&f(t)}export{M as onOutputsChanged,I as preparePlayback,g as requestMidiAccess,A as setSelectedOutput,O as startPlayback,h as stopPlayback};
